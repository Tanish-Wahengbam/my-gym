<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Lock In the Best Rate | FitnessForce</title>

        <!-- Google Fonts for Nunito -->
        <link
            href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap"
            rel="stylesheet">
        <link
            href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap"
            rel="stylesheet">

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet">
        <link rel="stylesheet" href="css/style.css" />
    </head>

    <body>

        <!-- Hero Section (Header) -->
        <section class="hero">
            <!-- Centered Logo -->
            <img src="images/logo.png" alt="MyGem Logo">
            <h1>Lock In the Best Rate</h1>
            <!-- <p>Get early access and exclusive offers—be the first to know when
            memberships go live as a Founding Member.</p> -->
        </section>

        <!-- Inquiry Form -->
        <section class="form-section container">
            <div class="row justify-content-center">
                <div class="col-md-6 shadow-lg">
                    <form id="reservationForm" class="row">
                        <!-- Name -->
                        <div class="col-12 mb-3">
                            <label for="name" class="form-label ">First
                                Name*</label>
                            <input type="text" id="name" name="fname"
                                placeholder="first name" required
                                class="form-control form-control-lg rounded-3 shadow-sm">
                        </div>

                        <div class="col-12 mb-3">
                            <label for="name" class="form-label ">Last
                                Name*</label>
                            <input type="text" id="name" name="lname"
                                placeholder="last name" required
                                class="form-control form-control-lg rounded-3 shadow-sm">
                        </div>

                        <!-- Email -->
                        <div class="col-12 mb-3">
                            <label for="email" class="form-label ">Email
                                Address*</label>
                            <input type="email" id="email" name="email"
                                placeholder="email" required
                                class="form-control form-control-lg rounded-3 shadow-sm">
                        </div>

                        <!-- Phone -->
                        <div class="col-12 mb-3">
                            <label for="phone" class="form-label ">Phone
                                Number*</label>
                            <input type="tel" id="phone" name="phone"
                                placeholder="phone number"
                                class="form-control form-control-lg rounded-3 shadow-sm">
                        </div>

                        <!-- Number of Guests -->
                        <div class="col-12 mb-3">
                            <label for="location" class="form-label ">
                                Location of Interest*</label>
                            <select id="locationDropdown" name="location"
                                required
                                class="form-select form-select-lg rounded-3 shadow-sm">
                                <option value selected disabled>Please
                                    select</option>
                            </select>
                        </div>
                        <!-- Checkbox for Terms and Conditions / Newsletter -->
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox"
                                    value id="termsCheckbox">
                                <label class="form-check-label text-secondary"
                                    for="termsCheckbox">
                                    <span>STAY UPDATED ON CLUB NEWS! By checking
                                        this box, I consent to receive
                                        promotional
                                        emails, calls (including prerecorded
                                        calls),
                                        and automated SMS texts from Crunch
                                        and/or
                                        its affiliates or agents. I confirm that
                                        I
                                        am the authorized user of the provided
                                        email
                                        and phone number. I understand that my
                                        consent is voluntary and not a condition
                                        of
                                        purchasing any goods or services. I can
                                        opt
                                        out anytime by unsubscribing from emails
                                        or
                                        texting STOP to any SMS. Standard
                                        message
                                        and data rates may apply. Messaging
                                        frequency varies. I also agree to the <a
                                            href="https://www.crunch.com/terms-of-use"
                                            rel="noopener">Terms
                                            of Use</a> and
                                        consent to the <a
                                            href="https://www.crunch.com/privacy-policy"
                                            rel="noopener">Privacy
                                            Policy</a> ,
                                        including collecting certain location
                                        and
                                        usage information.<span
                                            class="hs-form-required">*</span></span>
                                </label>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="col-12">
                            <button type="submit" id="reservationForm"
                                class="btn btn-primary btn-lg w-100 rounded-3 shadow-lg fw-bold btn-custom-hover">
                                Send Enquiry
                            </button>
                            <p id="errorMessage"
                                class="text-danger text-center mt-3"></p>
                        </div>
                    </form>
                    <!-- Add this spinner just before the closing </form> tag -->
                    <div class="text-center my-3">
                        <div id="formLoader" class="spinner-border text-primary"
                            style="display:none;" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <h4 style="font-weight:bold;">Reserve Your Rate Today
                    </h4>
                    <p>We love opening new clubs and are pumped to be adding a
                        location near you!

                        Patience may be a virtue, but it's cool with us if it's
                        not one of yours. Get in early by signing up
                        now to make sure you're the first to know when
                        memberships go on sale and have the opportunity to
                        secure your spot as a Founding Member. All you need to
                        do is submit your contact information and
                        you'll receive all the info on the lowest rates, plus
                        exclusive offers and giveaways.</p>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section class="services container">
            <h2>Our Services</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="service-card">
                        <img src="images/f1.jpg" alt="Personal Training">
                        <h5>Personal Training</h5>
                        <p>One-on-one training with expert coaches to achieve
                            your fitness goals.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="service-card">
                        <img src="images/f2.jpg" alt="Group Classes">
                        <h5>Group Classes</h5>
                        <p>Fun, energetic classes including Zumba, Yoga, HIIT &
                            more.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="service-card">
                        <img src="images/f3.jpg" alt="Nutrition Plans">
                        <h5>Nutrition Plans</h5>
                        <p>Customized diet guidance to keep your body fueled &
                            healthy.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Success Message Modal -->
        <div class="modal fade" id="successModal" tabindex="-1"
            aria-labelledby="successModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content rounded-3 shadow-lg p-4 text-center">
                    <div class="modal-body">
                        <svg class="mx-auto mb-4"
                            style="height: 5rem; width: 5rem; color: #28a745;"
                            fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h3 class="h3 fw-bold text-dark mb-3">Reservation
                            Confirmed!</h3>
                        <p class="text-secondary fs-5">Thank you for
                            your reservation. We look forward to seeing
                            you!</p>
                        <button type="button"
                            class="btn btn-primary rounded-3 shadow-sm mt-4"
                            data-bs-dismiss="modal">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <img src="images/logo.svg" alt="FitnessForce Logo">
            <p>&copy; 2025 FitnessForce.com. All Rights Reserved.</p>
            <a class="shadow-sm btn-footer px-3" href="#">
                Book a Tour
            </a>
        </footer>

        <!-- Tour Booking Modal -->
        <div class="modal fade" id="tourBookingModal" tabindex="-1"
            aria-labelledby="tourBookingModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="tourBookingModalLabel">Book
                            a Tour</h5>
                        <p>Enter your information to reserve your slot</p>
                        <button type="button" class="btn-close"
                            data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="stepper-wrapper mb-4">
                            <div class="stepper-item active" id="stepper1">
                                <div class="step-counter"><svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="22" height="22"
                                        viewBox="0 0 24 24" fill="currentColor">
                                        <path
                                            d="M7 11h2v2H7v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2zM7 15h2v2H7v-2zm4 
  0h2v2h-2v-2zm4 0h2v2h-2v-2zM6 3h1V1h2v2h6V1h2v2h1a2 2 0 0 1 2 
  2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm0 
  4v12h12V7H6z" />
                                    </svg></div>
                                <div class="step-name">Select Dates</div>
                            </div>
                            <div class="stepper-item" id="stepper2">
                                <div class="step-counter"><svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="22" height="22"
                                        viewBox="0 0 24 24" fill="currentColor">
                                        <path
                                            d="M12 1a11 11 0 1 0 11 11A11.013 11.013 0 0 0 12 
  1zm0 20a9 9 0 1 1 9-9a9.01 9.01 0 0 1-9 9zm.5-13H11v6l5.25 
  3.15l.75-1.23l-4.5-2.67z" />
                                    </svg></div>
                                <div class="step-name">Choose Slot</div>
                            </div>
                            <div class="stepper-item" id="stepper3">
                                <div class="step-counter"><svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="22" height="22"
                                        viewBox="0 0 24 24" fill="currentColor">
                                        <path
                                            d="M12 12a5 5 0 1 0-5-5a5 5 0 0 0 5 
  5zm0 2c-3.33 0-10 1.67-10 
  5v3h20v-3c0-3.33-6.67-5-10-5z" />
                                    </svg></div>
                                <div class="step-name">Your Details</div>
                            </div>
                        </div>
                        <form id="tourBookingForm">
                            <!-- Step 1: Date Selection -->
                            <div class="step" id="step1">
                                <!-- <span>Select Tour Dates</span> -->
                                <div
                                    class="date-error-message text-center"></div>
                                <div class="mb-3">
                                    <label class="form-label">Start Date</label>
                                    <input type="date" class="form-control"
                                        id="startDate" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">End Date</label>
                                    <input type="date" class="form-control"
                                        id="endDate" required>
                                </div>
                            </div>

                            <!-- Step 2: Time Slot Selection -->
                            <!-- <div class="step" id="step2" style="display: none;">
                            <div class="mb-3">
                                <select class="form-select" id="timeSlot" required>
                                    <option value>Choose a time
                                        slot</option>
                                </select>
                            </div>
                        </div> -->
                            <div class="step" id="step2" style="display: none;">
                                <div
                                    class="slot-time-error-message text-center"></div>
                                <label for="dateSelect">Choose a Date:</label>
                                <select id="dateSelect" class="form-control">
                                    <option value>Select a date</option>
                                </select>

                                <div id="timeSlotsContainer" class="mt-3"></div>
                            </div>

                            <!-- Step 3: Personal Details -->
                            <div class="step" id="step3" style="display: none;">
                                <!-- <h6>Your Details</h6> -->
                                <div class="mb-3">
                                    <input type="text" class="form-control"
                                        placeholder="Full Name" id="fullName"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <input type="email" class="form-control"
                                        placeholder="Email" id="tourEmail"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <input type="tel" class="form-control"
                                        placeholder="Phone Number"
                                        id="tourPhone"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <select class="form-control" id="country"
                                        required>
                                        <option value>Select Country</option>
                                        <option value="USA">United
                                            States</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <select class="form-control" id="state"
                                        required>
                                        <option value>Select State</option>
                                        <option value="AL">Alabama</option>
                                        <option value="AK">Alaska</option>
                                        <option value="AZ">Arizona</option>
                                        <option value="AR">Arkansas</option>
                                        <option value="CA">California</option>
                                        <option value="CO">Colorado</option>
                                        <option value="CT">Connecticut</option>
                                        <option value="DE">Delaware</option>
                                        <option value="FL">Florida</option>
                                        <option value="GA">Georgia</option>
                                        <option value="HI">Hawaii</option>
                                        <option value="ID">Idaho</option>
                                        <option value="IL">Illinois</option>
                                        <option value="IN">Indiana</option>
                                        <option value="IA">Iowa</option>
                                        <option value="KS">Kansas</option>
                                        <option value="KY">Kentucky</option>
                                        <option value="LA">Louisiana</option>
                                        <option value="ME">Maine</option>
                                        <option value="MD">Maryland</option>
                                        <option
                                            value="MA">Massachusetts</option>
                                        <option value="MI">Michigan</option>
                                        <option value="MN">Minnesota</option>
                                        <option value="MS">Mississippi</option>
                                        <option value="MO">Missouri</option>
                                        <option value="MT">Montana</option>
                                        <option value="NE">Nebraska</option>
                                        <option value="NV">Nevada</option>
                                        <option value="NH">New
                                            Hampshire</option>
                                        <option value="NJ">New Jersey</option>
                                        <option value="NM">New Mexico</option>
                                        <option value="NY">New York</option>
                                        <option value="NC">North
                                            Carolina</option>
                                        <option value="ND">North Dakota</option>
                                        <option value="OH">Ohio</option>
                                        <option value="OK">Oklahoma</option>
                                        <option value="OR">Oregon</option>
                                        <option value="PA">Pennsylvania</option>
                                        <option value="RI">Rhode Island</option>
                                        <option value="SC">South
                                            Carolina</option>
                                        <option value="SD">South Dakota</option>
                                        <option value="TN">Tennessee</option>
                                        <option value="TX">Texas</option>
                                        <option value="UT">Utah</option>
                                        <option value="VT">Vermont</option>
                                        <option value="VA">Virginia</option>
                                        <option value="WA">Washington</option>
                                        <option value="WV">West
                                            Virginia</option>
                                        <option value="WI">Wisconsin</option>
                                        <option value="WY">Wyoming</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <input type="text" class="form-control"
                                        placeholder="City" id="city"
                                        required>
                                </div>

                                <div class="mb-3">
                                    <textarea class="form-control"
                                        placeholder="Notes" id="tourNotes"
                                        rows="4" required></textarea>
                                </div>

                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    id="prevBtn"
                                    style="display: none;">Previous</button>
                                <button type="button" class="btn btn-primary"
                                    id="nextBtn">Next</button>
                                <button type="submit" class="btn btn-success"
                                    id="submitBtn"
                                    style="display: none;">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- jQuery CDN (add before Bootstrap JS) -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <!-- Add jQuery Validation plugin CDN after jQuery -->
        <script
            src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
        <!-- Bootstrap Bundle with Popper -->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>

        <script>

        $('#startDate, #endDate').on('change', function () {
            $('.date-error-message').text(''); // clear error

            const startDate = new Date($('#startDate').val());
            const endDate = new Date($('#endDate').val());

            if (startDate && endDate) {
                const diffTime = endDate - startDate;
                const diffDays = diffTime / (1000 * 60 * 60 * 24); // convert ms → days

                if (diffDays < 0) {
                    $('.date-error-message').text('End date cannot be before start date').css('color', 'red');
                    $('#endDate').val('');
                } else if (diffDays > 7) {
                    $('.date-error-message').text('Date range cannot exceed 7 days').css('color', 'red');
                    $('#endDate').val('');
                }
            }
        });
        // Fetch tenants for dropdown
        fetch('/api/tenants')
            .then(res => res.json())
            .then(data => {
                const dropdown = document.getElementById('locationDropdown');
                const tenants = data.items || [];

                // Get location from query string
                const urlParams = new URLSearchParams(window.location.search);
                const locationParam = urlParams.get('location');

                // Clear existing options first
                dropdown.innerHTML = '';

                // Filter tenants by PreSales status FIRST
                const preSalesTenants = tenants.filter(tenant => tenant.id === 120);
                // const preSalesTenants = tenants;

                // Add placeholder only if there are multiple PreSales locations and no preselected location
                if (preSalesTenants.length > 1 && !locationParam) {
                    const placeholderOption = document.createElement('option');
                    placeholderOption.value = '';
                    placeholderOption.selected = true;
                    placeholderOption.disabled = true;
                    placeholderOption.textContent = 'Please select';
                    dropdown.appendChild(placeholderOption);
                }

                // Add the filtered tenants to dropdown
                preSalesTenants.forEach(tenant => {
                    const option = document.createElement('option');
                    option.value = tenant.tenant_uuid;
                    option.textContent = tenant.name_primary_language + ' (' +
                        tenant.status.replace(/([A-Z])/g, ' $1').trim() + ')';
                    dropdown.appendChild(option);
                });

                // Handle preselection logic
                if (locationParam) {
                    // Try to find and select the location by name or UUID
                    const matchingOption = Array.from(dropdown.options).find(option =>
                        option.textContent.toLowerCase().includes(locationParam.toLowerCase()) ||
                        option.value === locationParam
                    );

                    if (matchingOption) {
                        matchingOption.selected = true;
                        dropdown.dispatchEvent(new Event('change'));
                    }
                } else if (preSalesTenants.length === 1) {
                    // If only one PreSales location, automatically select it
                    dropdown.selectedIndex = 0; // No placeholder was added, so first option is the location
                    dropdown.dispatchEvent(new Event('change'));
                }
            })
            .catch(error => {
                console.error('Error fetching tenants:', error);
            });
        // Replace the form submit handler with jQuery validation
        $(function () {
            $('#reservationForm').validate({
                rules: {
                    fname: { required: true },
                    lname: { required: true },
                    email: { required: true, email: true },
                    phone: { required: true, minlength: 8 },
                    location: { required: true }
                },
                messages: {
                    fname: 'First name is required',
                    lname: 'Last name is required',
                    email: {
                        required: 'Email is required',
                        email: 'Please enter a valid email address'
                    },
                    phone: {
                        required: 'Phone number is required',
                        minlength: 'Phone number must be at least 8 digits'
                    },
                    location: 'Please select a location'
                },
                errorClass: 'is-invalid',
                validClass: 'is-valid',
                errorElement: 'div',
                errorPlacement: function (error, element) {
                    error.addClass('invalid-feedback');
                    if (element.parent('.input-group').length) {
                        error.insertAfter(element.parent());
                    } else {
                        error.insertAfter(element);
                    }
                },
                highlight: function (element) {
                    $(element).addClass('is-invalid').removeClass('is-valid');
                },
                unhighlight: function (element) {
                    $(element).removeClass('is-invalid').addClass('is-valid');
                },
                submitHandler: async function (form, event) {
                    event.preventDefault();
                    const submitBtn = $(form).find('button[type="submit"]')[0];
                    const loader = document.getElementById('formLoader');
                    submitBtn.disabled = true;
                    loader.style.display = 'inline-block';
                    document.getElementById('errorMessage').textContent = '';
                    try {
                        const payload = {
                            fname: form.fname.value,
                            lname: form.lname.value,
                            email: form.email.value,
                            mobile: form.phone.value,
                            location: form.location.options[form.location.selectedIndex].text,
                            tenant_uuid: form.location.value
                        };

                        // Check for client_representative_id parameter and add if exists
                        const urlParams = new URLSearchParams(window.location.search);
                        const clientRepId = urlParams.get('client_representative_id');
                        if (clientRepId) {
                            payload.client_representative_id = clientRepId;
                        }

                        const res = await fetch('/api/leads', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await res.json();
                        if (result.success) {
                            $('#successModal').modal('show');
                            form.reset();
                            $(form).find('.is-valid').removeClass('is-valid');
                        } else {
                            document.getElementById('errorMessage').textContent = result.error[0]?.errorMessage || 'Submission failed.';
                        }
                    } catch (err) {
                        document.getElementById('errorMessage').textContent = 'An error occurred. Please try again.';
                    } finally {
                        submitBtn.disabled = false;
                        loader.style.display = 'none';
                    }
                }
            });
        });

        let currentStep = 1;
        const totalSteps = 3;
        let selectedSlot = null;

        // Event listener for "Book a Tour" button
        document.querySelector('.btn-footer').addEventListener('click', () => {
            $('#tourBookingModal').modal('show');
        });

        // Add this to your existing JavaScript where you handle steps
        function updateStepper(step) {
            // Remove active class from all steppers
            document.querySelectorAll('.stepper-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to current step
            document.getElementById(`stepper${step}`).classList.add('active');
        }

        // Handle Next button
        document.getElementById('nextBtn').addEventListener('click', async () => {
            if (currentStep === 1) {

                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;

                if (!startDate || !endDate) {
                    $('.date-error-message').text('Please select both dates').css('color', 'red');
                    return;
                }

                loadSlots(startDate, endDate, "405ac829-d6f3-407c-8eae-38ac74667594");
            }

            if (currentStep === 2) {
                const selectedSlot = document.querySelector('.time-slot.selected');
                if (!selectedSlot) {
                    $('.slot-time-error-message ').text('Please select a slot time').css('color', 'red');
                    return; // stop navigation
                }
            }

            if (currentStep < totalSteps) {
                document.getElementById(`step${currentStep}`).style.display = 'none';
                currentStep++;
                document.getElementById(`step${currentStep}`).style.display = 'block';
                updateStepper(currentStep); // Add this line

                if (currentStep > 1) {
                    document.getElementById('prevBtn').style.display = 'block';
                }

                if (currentStep === totalSteps) {
                    document.getElementById('nextBtn').style.display = 'none';
                    document.getElementById('submitBtn').style.display = 'block';
                }
            }
        });

        async function loadSlots(startDate, endDate, tenant_uuid) {
            try {
                const response = await fetch(`/api/slots?startDate=${startDate}&endDate=${endDate}&tenant_uuid=${tenant_uuid}`);
                const data = await response.json();

                const dateSelect = document.getElementById('dateSelect');
                const timeSlotsContainer = document.getElementById('timeSlotsContainer');

                dateSelect.innerHTML = '<option value="">Select a date</option>';
                timeSlotsContainer.innerHTML = '';

                if (data.Staffs && data.Staffs.length > 0) {
                    const slotsByDate = {};

                    data.Staffs.forEach(staff => {
                        staff.days.forEach(day => {
                            const dateOnly = new Date(day.date).toLocaleDateString();
                            if (!slotsByDate[dateOnly]) slotsByDate[dateOnly] = [];

                            day.spots.forEach(spot => {
                                slotsByDate[dateOnly].push(spot);
                            });
                        });
                    });


                    Object.keys(slotsByDate).forEach(date => {
                        const option = document.createElement('option');
                        option.value = date;
                        option.textContent = date;
                        dateSelect.appendChild(option);
                    });


                    dateSelect.onchange = function () {
                        const selectedDate = this.value;
                        timeSlotsContainer.innerHTML = '';

                        if (slotsByDate[selectedDate]) {
                            slotsByDate[selectedDate].forEach(timeStr => {
                                const rawDate = new Date(timeStr);
                                const formattedTime = rawDate.toLocaleTimeString([], {
                                    hour: '2-digit',
                                    minute: '2-digit',
                                    timeZone: 'UTC'
                                });
                                // Example: 10:00 AM

                                const timeBtn = document.createElement('div');
                                timeBtn.className = 'time-slot';
                                timeBtn.textContent = formattedTime;
                                timeBtn.dataset.value = timeStr;

                                timeBtn.onclick = function () {
                                    document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected'));
                                    this.classList.add('selected');
                                    console.log("Selected slot:", this.dataset.value);
                                };

                                timeSlotsContainer.appendChild(timeBtn);
                            });
                        } else {
                            timeSlotsContainer.innerHTML = '<p style="color:red">No time slots available</p>';
                        }
                    };

                } else {
                    $('.date-error-message').text('No available slots for selected dates').css('color', 'red');
                }

            } catch (error) {
                console.error('Error fetching slots:', error);
                $('.date-error-message').text('Error loading available slots');
            }
        }

        // Handle Previous button
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).style.display = 'none';
                currentStep--;
                document.getElementById(`step${currentStep}`).style.display = 'block';
                updateStepper(currentStep); // Add this line

                if (currentStep === 1) {
                    document.getElementById('prevBtn').style.display = 'none';
                }

                document.getElementById('nextBtn').style.display = 'block';
                document.getElementById('submitBtn').style.display = 'none';
            }
        });

        // Handle form submission
        document.getElementById('tourBookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
             const phoneInput = document.getElementById('tourPhone');
            const phone = document.getElementById('tourPhone').value.trim();
            const selectedSlot = document.querySelector('.time-slot.selected');

                const phoneRegex = /^\d{10}$/;
if (!phoneRegex.test(phone)) {
        const errorMsg = document.createElement('div');
        errorMsg.className = 'phone-error text-danger mt-1';
        errorMsg.innerText = "Please enter a valid 10-digit phone number.";
        phoneInput.insertAdjacentElement('afterend', errorMsg);
        return;
    }
            const formData = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('tourEmail').value,
                phone: document.getElementById('tourPhone').value,
                state: document.getElementById('state').value,
                city: document.getElementById('city').value,
                country: document.getElementById('country').value,
                notes: document.getElementById('tourNotes').value,
                tenant_uuid: "405ac829-d6f3-407c-8eae-38ac74667594",
                timeSlot: selectedSlot.dataset.value
            };

            try {
                const response = await fetch('/api/book-tour', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                // Parse the JSON response
                const data = await response.json();

                if (response.ok) {
                    $('#tourBookingModal').modal('hide');
                    $('#successModal').modal('show');
                    // Reset form
                    document.getElementById('tourBookingForm').reset();
                    currentStep = 1;
                    document.querySelectorAll('.step').forEach(step => step.style.display = 'none');
                    document.getElementById('step1').style.display = 'block';
                    document.getElementById('nextBtn').style.display = 'block';
                    document.getElementById('prevBtn').style.display = 'none';
                    document.getElementById('submitBtn').style.display = 'none';
                } else {
                    alert('Error booking tour. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error booking tour. Please try again.');
            }
        });
    
    </script>

    </body>

</html>